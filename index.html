<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>News Pulse</title>

  <style>
    :root {
      --bg:#f6f7fb;
      --card:#ffffff;
      --muted:#6b7280;
      --text:#111827;
      --border:#e5e7eb;
      --accent:#2563eb;
      --chip:#eef2ff;
    }
    body {
      margin:0;
      font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--text);
      background:var(--bg);
      display:flex;
      justify-content:center;
    }
    .wrap {
      width:100%;
      max-width:900px;
      margin:24px auto;
      padding:0 16px;
    }
    header{margin-bottom:16px;text-align:center}
    h1{margin:0 0 4px;font-size:28px}
    .sub{color:var(--muted);font-size:13px}

    .card {
      background:var(--card);
      border:1px solid var(--border);
      border-radius:14px;
      padding:16px;
      margin-bottom:16px;
    }
    .card h2{margin:0 0 8px;font-size:16px}
    .hint{color:var(--muted);font-size:12px}

    /* Heatmap (smaller cells) */
    /* Heatmap (smaller cells everywhere) */
.heatmap {
  display:grid;
  grid-template-columns:repeat(24,14px);
  gap:4px;
  padding:10px;
  border-radius:12px;
  background:#fafafa;
  border:1px dashed var(--border);
}
.cell {
  width:14px;
  height:14px;
  border-radius:3px;
  background:#e5e7eb;
}
.rowlab .label {
  width:26px;
  text-align:right;
  color:var(--muted);
  font-size:11px;
}
.hours {
  display:grid;
  grid-template-columns:repeat(24,14px);
  gap:4px;
  margin:0 0 8px 34px;
  color:var(--muted);
  font-size:9px;
}

    /* Tweets */
    .tweet{border-top:1px solid var(--border);padding:10px 0}
    .tweet:first-child{border-top:none}
    .tweet .meta{color:var(--muted);font-size:12px;margin-bottom:4px}
    .eng{display:flex;gap:10px;color:var(--muted);font-size:12px;flex-wrap:wrap}
    .eng b{color:var(--text);margin-left:4px}

    /* Articles */
    details{border:1px solid var(--border);border-radius:14px;background:var(--card)}
    summary{cursor:pointer;padding:14px 16px;font-weight:600;list-style:none}
    summary::-webkit-details-marker{display:none}
    .tbl-wrap{padding:0 16px 16px}
    table{width:100%;border-collapse:collapse}
    th,td{border-top:1px solid var(--border);padding:10px 8px;text-align:left;font-size:13px}
    th{color:var(--muted);font-weight:600}
    tr:hover td{background:#fafafa}

    /* Insights */
    .kv{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .kv .k{color:var(--muted);font-size:11px}
    .kv .v{font-weight:600}
    .btn{display:inline-block;background:var(--accent);color:#fff;border-radius:8px;padding:6px 10px;font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>News Pulse</h1>
      <div class="sub">Static dashboard. Data updates via GitHub Actions.</div>
    </header>

    <!-- X heatmaps stacked -->
    <section class="card">
      <h2>X: Link Posts Heatmap (PT ¬∑ starts 6:00 AM)</h2>
      <div class="hint">Counts of posts that included a link. Darker = more posts.</div>
      <div id="x-links-hours" class="hours"></div>
      <div id="x-links" class="heatmap"></div>
    </section>

    <section class="card">
      <h2>X: Engagement Heatmap (PT ¬∑ starts 6:00 AM)</h2>
      <div class="hint">Sum of likes + replies + retweets + quotes. Darker = more engagement.</div>
      <div id="x-eng-hours" class="hours"></div>
      <div id="x-eng" class="heatmap"></div>
    </section>

    <!-- Latest tweets -->
    <section class="card">
      <h2>Latest Tweets (last 5)</h2>
      <div id="tweets" class="hint">Loading‚Ä¶</div>
    </section>

    <!-- RSS heatmap -->
    <section class="card">
      <h2>Publish Heatmap (RSS ¬∑ PT ¬∑ starts 6:00 AM)</h2>
      <div class="hint">Rows = Sun‚ÜíSat, Columns = 6AM‚Üí5AM PT. Darker blue = more published items.</div>
      <div id="rss-hours" class="hours"></div>
      <div id="rss" class="heatmap"></div>
    </section>

    <!-- Insights + Articles -->
    <section class="card">
      <h2>Insights</h2>
      <div class="kv">
        <div>
          <div class="k">Last Updated</div>
          <div class="v" id="last-updated">‚Äî</div>
        </div>
        <div>
          <div class="k">Timezone</div>
          <div class="v">PT (America/Los_Angeles)</div>
        </div>
      </div>
      <div style="margin-top:12px">
        <a class="btn" href="data/posts.csv">Download CSV</a>
      </div>
    </section>

    <section class="card">
      <details open>
        <summary>Recently Published Articles</summary>
        <div class="tbl-wrap">
          <div class="hint" id="posts-count">Loading‚Ä¶</div>
          <table id="posts-table">
            <thead>
              <tr><th style="width:20%">Publisher</th><th>Title</th><th style="width:18%">Published (PT)</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </details>
    </section>
  </div>

  <script>
    const days = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
    const hours = [...Array(24).keys()].map(h => h);

    // Draw hour labels
    function drawHours(containerId){
      const el=document.getElementById(containerId);
      el.innerHTML="";
      hours.forEach(h=>{
        const d=document.createElement("div");
        d.textContent=h;
        el.appendChild(d);
      });
    }
    drawHours("x-links-hours");
    drawHours("x-eng-hours");
    drawHours("rss-hours");

    // Heatmap drawing
    function drawHeatmap(containerId,data){
      const el=document.getElementById(containerId);
      el.innerHTML="";
      days.forEach((day,i)=>{
        hours.forEach((h,j)=>{
          const cell=document.createElement("div");
          cell.className="cell";
          const val=data?.[i]?.[j]||0;
          const alpha=Math.min(1, val/10);
          cell.style.background=`rgba(37,99,235,${alpha})`;
          el.appendChild(cell);
        });
      });
    }

    // Load heatmap JSONs
    fetch("data/x_links_heatmap.json").then(r=>r.json()).then(data=>{
      drawHeatmap("x-links", data);
    });
    fetch("data/x_heatmap_engagement.json").then(r=>r.json()).then(data=>{
      drawHeatmap("x-eng", data);
    });
    fetch("data/rss_heatmap.json").then(r=>r.json()).then(data=>{
      drawHeatmap("rss", data);
    });

    // Load tweets
    fetch("data/x_posts.json").then(r=>r.json()).then(data=>{
      const tweetsDiv=document.getElementById("tweets");
      tweetsDiv.innerHTML="";
      data.slice(0,5).forEach(t=>{
        const div=document.createElement("div");
        div.className="tweet";
        div.innerHTML=`
          <div class="meta">@${t.user} ‚Äì ${t.date}</div>
          <div>${t.text}</div>
          <div class="eng">
            <span>‚ù§Ô∏è <b>${t.likes}</b></span>
            <span>üí¨ <b>${t.replies}</b></span>
            <span>üîÅ <b>${t.retweets}</b></span>
            <span>üîó <b>${t.quotes}</b></span>
          </div>`;
        tweetsDiv.appendChild(div);
      });
    });

    // Load posts
    fetch("data/posts.json").then(r=>r.json()).then(data=>{
      const tbody=document.querySelector("#posts-table tbody");
      document.getElementById("posts-count").textContent = data.length+" items (last 14 days)";
      tbody.innerHTML="";
      data.slice(0,20).forEach(p=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`<td>${p.publisher||""}</td><td><a href="${p.link}" target="_blank">${p.title}</a></td><td>${p.published}</td>`;
        tbody.appendChild(tr);
      });
    });

    // Load summary
    fetch("data/x_summary.json").then(r=>r.json()).then(meta=>{
      document.getElementById("last-updated").textContent=meta.last_updated;
    });
  </script>
</body>
</html>
